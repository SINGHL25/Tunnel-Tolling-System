<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Tunnel Control & Tolling System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .panel h2 {
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }

        .tunnel-container {
            position: relative;
            background: linear-gradient(180deg, #2c2c2c 0%, #1a1a1a 100%);
            border-radius: 20px;
            padding: 40px;
            min-height: 500px;
            overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.5);
        }

        .tunnel-road {
            position: relative;
            height: 300px;
            background: linear-gradient(to bottom, #3a3a3a 0%, #2a2a2a 50%, #3a3a3a 100%);
            border-radius: 10px;
            overflow: hidden;
        }

        .lane {
            position: absolute;
            width: 100%;
            height: 33.33%;
            border-bottom: 2px dashed #ffeb3b;
            opacity: 0.3;
        }

        .lane:nth-child(2) {
            top: 33.33%;
        }

        .lane:nth-child(3) {
            top: 66.66%;
            border-bottom: none;
        }

        .vehicle {
            position: absolute;
            width: 60px;
            height: 35px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            border-radius: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }

        .vehicle::before {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ffeb3b;
            border-radius: 50%;
            top: 5px;
            left: 5px;
            box-shadow: 40px 0 0 #ffeb3b, 0 20px 0 #ff0000, 40px 20px 0 #ff0000;
        }

        .vehicle.hot {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            animation: pulse 1s infinite;
        }

        .vehicle.dangerous {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            animation: warning-flash 0.5s infinite;
        }

        .vehicle.overheight {
            background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
            height: 50px;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000; }
            50% { box-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000; }
        }

        @keyframes warning-flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .traffic-light {
            display: inline-block;
            width: 30px;
            height: 80px;
            background: #333;
            border-radius: 5px;
            padding: 5px;
            margin: 10px;
            position: relative;
        }

        .light {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 3px auto;
            opacity: 0.3;
            transition: all 0.3s;
        }

        .light.red {
            background: #ff0000;
        }

        .light.yellow {
            background: #ffeb3b;
        }

        .light.green {
            background: #4caf50;
        }

        .light.active {
            opacity: 1;
            box-shadow: 0 0 20px currentColor;
        }

        .sign {
            background: #1a1a1a;
            border: 3px solid #ffeb3b;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }

        .sign.warning {
            border-color: #ff9800;
            color: #ff9800;
        }

        .sign.danger {
            border-color: #ff0000;
            color: #ff0000;
            animation: sign-blink 1s infinite;
        }

        @keyframes sign-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button.emergency {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
        }

        button.success {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }

        .camera-feed {
            background: #000;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            min-height: 150px;
            position: relative;
            overflow: hidden;
        }

        .camera-feed::before {
            content: 'LIVE';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff0000;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .camera-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2px;
            height: 100%;
        }

        .camera-view {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            border: 1px solid #333;
            position: relative;
            min-height: 70px;
        }

        .sensor-indicator {
            display: flex;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin: 8px 0;
        }

        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse-dot 2s infinite;
        }

        .indicator-dot.active {
            background: #4caf50;
        }

        .indicator-dot.warning {
            background: #ff9800;
        }

        .indicator-dot.alert {
            background: #ff0000;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .knowledge-base {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .knowledge-base::-webkit-scrollbar {
            width: 8px;
        }

        .knowledge-base::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .knowledge-base::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        .kb-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .kb-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .kb-item h3 {
            font-size: 1em;
            margin-bottom: 5px;
        }

        .kb-item p {
            font-size: 0.85em;
            opacity: 0.8;
            line-height: 1.4;
        }

        .toll-booth {
            position: absolute;
            width: 80px;
            height: 100%;
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .transaction-log {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.85em;
            font-family: 'Courier New', monospace;
        }

        .log-entry {
            padding: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .emergency-panel {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff0000;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .emergency-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
            margin-top: 10px;
            font-size: 1.1em;
            padding: 15px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .status-item {
            text-align: center;
            flex: 1;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .modal-close {
            float: right;
            font-size: 1.5em;
            cursor: pointer;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🚇 Advanced Tunnel Control & Tolling System</h1>
            <p class="subtitle">Intelligent Traffic Management & Safety Monitoring</p>
        </header>

        <div class="status-bar">
            <div class="status-item">
                <div>🟢 System Status</div>
                <div id="systemStatus">OPERATIONAL</div>
            </div>
            <div class="status-item">
                <div>🚗 Traffic Flow</div>
                <div id="trafficFlow">NORMAL</div>
            </div>
            <div class="status-item">
                <div>⚠️ Alerts</div>
                <div id="alertCount">0</div>
            </div>
            <div class="status-item">
                <div>🕐 Uptime</div>
                <div id="uptime">00:00:00</div>
            </div>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2>🎛️ Control Center</h2>
                
                <div class="controls">
                    <button onclick="addVehicle('normal')">Add Vehicle</button>
                    <button onclick="addVehicle('hot')" class="emergency">Hot Vehicle</button>
                    <button onclick="addVehicle('dangerous')" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%)">Dangerous Goods</button>
                    <button onclick="addVehicle('overheight')" style="background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%)">Over-Height</button>
                </div>

                <div style="margin-top: 20px;">
                    <h3 style="font-size: 1.1em; margin-bottom: 10px;">Traffic Lights</h3>
                    <div style="display: flex; justify-content: space-around;">
                        <div>
                            <div class="traffic-light" id="entryLight">
                                <div class="light red" id="entryRed"></div>
                                <div class="light yellow" id="entryYellow"></div>
                                <div class="light green active" id="entryGreen"></div>
                            </div>
                            <div style="text-align: center; font-size: 0.8em;">Entry</div>
                        </div>
                        <div>
                            <div class="traffic-light" id="exitLight">
                                <div class="light red" id="exitRed"></div>
                                <div class="light yellow" id="exitYellow"></div>
                                <div class="light green active" id="exitGreen"></div>
                            </div>
                            <div style="text-align: center; font-size: 0.8em;">Exit</div>
                        </div>
                    </div>
                </div>

                <div class="sign" id="mainSign">TUNNEL OPEN - DRIVE SAFELY</div>

                <div class="emergency-panel">
                    <h3 style="margin-bottom: 10px;">🚨 Emergency Controls</h3>
                    <button class="emergency-btn" onclick="emergencyClose()">EMERGENCY CLOSURE</button>
                    <button class="emergency-btn" onclick="fireAlarm()">FIRE ALARM</button>
                    <button class="success" style="width: 100%; margin-top: 10px;" onclick="resetSystem()">Reset System</button>
                </div>
            </div>

            <div class="panel">
                <h2>🛣️ Tunnel Visualization</h2>
                <div class="tunnel-container">
                    <div class="toll-booth" style="left: 20px;">ENTRY TOLL</div>
                    <div class="toll-booth" style="right: 20px;">EXIT TOLL</div>
                    
                    <div class="tunnel-road" id="tunnelRoad">
                        <div class="lane"></div>
                        <div class="lane"></div>
                        <div class="lane"></div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h3 style="font-size: 1.1em; margin-bottom: 10px;">📹 Camera Monitoring</h3>
                        <div class="camera-feed">
                            <div class="camera-grid">
                                <div class="camera-view">
                                    <div style="padding: 10px; font-size: 0.8em;">CAM-01 Entry</div>
                                </div>
                                <div class="camera-view">
                                    <div style="padding: 10px; font-size: 0.8em;">CAM-02 Mid</div>
                                </div>
                                <div class="camera-view">
                                    <div style="padding: 10px; font-size: 0.8em;">CAM-03 Exit</div>
                                </div>
                                <div class="camera-view">
                                    <div style="padding: 10px; font-size: 0.8em;">CAM-04 Emergency</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="vehicleCount">0</div>
                        <div class="stat-label">Vehicles in Tunnel</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalTransactions">0</div>
                        <div class="stat-label">Total Transactions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgSpeed">65</div>
                        <div class="stat-label">Avg Speed (km/h)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="revenue">$0</div>
                        <div class="stat-label">Revenue Today</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>📊 Monitoring & Logs</h2>
                
                <h3 style="font-size: 1em; margin-bottom: 10px;">Detection Systems</h3>
                <div class="sensor-indicator">
                    <div class="indicator-dot active"></div>
                    <span>Over-Height Detection</span>
                </div>
                <div class="sensor-indicator">
                    <div class="indicator-dot active"></div>
                    <span>Hot Spot Detection</span>
                </div>
                <div class="sensor-indicator">
                    <div class="indicator-dot active"></div>
                    <span>Dangerous Goods Detection</span>
                </div>
                <div class="sensor-indicator">
                    <div class="indicator-dot active"></div>
                    <span>License Plate Recognition</span>
                </div>
                <div class="sensor-indicator">
                    <div class="indicator-dot active"></div>
                    <span>Speed Enforcement</span>
                </div>

                <h3 style="font-size: 1em; margin: 15px 0 10px 0;">Transaction Log</h3>
                <div class="transaction-log" id="transactionLog">
                    <div class="log-entry">System initialized...</div>
                </div>

                <h3 style="font-size: 1em; margin: 15px 0 10px 0;">📚 Knowledge Base</h3>
                <div class="knowledge-base">
                    <div class="kb-item" onclick="showKB('lcs')">
                        <h3>Lane Control Signs (LCS)</h3>
                        <p>Display current lane status and traffic diversions. Typically installed every 200-400m.</p>
                    </div>
                    <div class="kb-item" onclick="showKB('vsls')">
                        <h3>Speed Limit Signs (VSLS)</h3>
                        <p>Display current speed limits according to tunnel status. Usually installed every 400m.</p>
                    </div>
                    <div class="kb-item" onclick="showKB('vms')">
                        <h3>Variable Message Signs (VMS)</h3>
                        <p>Located at tunnel accesses to indicate status and display diversion routes.</p>
                    </div>
                    <div class="kb-item" onclick="showKB('overheight')">
                        <h3>Over-Height Detection</h3>
                        <p>Uses photoelectric barriers to detect vehicles exceeding height limits to prevent tunnel access.</p>
                    </div>
                    <div class="kb-item" onclick="showKB('dangerous')">
                        <h3>Dangerous Goods Detection</h3>
                        <p>CCTV cameras detect dangerous goods plates through video image processing.</p>
                    </div>
                    <div class="kb-item" onclick="showKB('hotspot')">
                        <h3>Hot Spot Detection</h3>
                        <p>Thermal cameras and laser scanners identify overheated vehicle components to prevent fires.</p>
                    </div>
                    <div class="kb-item" onclick="showKB('emergency')">
                        <h3>Emergency Telephones</h3>
                        <p>Hands-free phones with push button installed every 150-200m for user communication.</p>
                    </div>
                    <div class="kb-item" onclick="showKB('pa')">
                        <h3>Public Address System</h3>
                        <p>Loudspeakers along tunnel allow operators to transmit voice messages to specific zones.</p>
                    </div>
                    <div class="kb-item" onclick="showKB('lpr')">
                        <h3>License Plate Recognition</h3>
                        <p>Video processing for travel time measurement, vehicle counting, and speed enforcement.</p>
                    </div>
                    <div class="kb-item" onclick="showKB('fire')">
                        <h3>Fire Safety Protocol</h3>
                        <p>Facilitate self-evacuation, protect users, allow emergency access, and coordinate with services.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="kbModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">System Information</h2>
            <p id="modalContent" style="line-height: 1.6; margin-top: 15px;"></p>
        </div>
    </div>

    <script>
        const state = {
            vehicles: [],
            vehicleCount: 0,
            transactions: 0,
            revenue: 0,
            startTime: Date.now(),
            emergencyMode: false,
            nextVehicleId: 1
        };

        const knowledgeBase = {
            lcs: {
                title: "Lane Control Signs (LCS)",
                content: "Lane Control Signs are crucial traffic management devices that display the current status of traffic lanes to drivers. They signalize traffic diversions and lane closures in real-time. These signs are typically installed at intervals of 200 to 400 meters throughout the tunnel to ensure continuous visibility and driver awareness. LCS help manage traffic flow dynamically based on current conditions, incidents, or maintenance activities."
            },
            vsls: {
                title: "Vehicle Speed Limit Signs (VSLS)",
                content: "Variable Speed Limit Signs display adaptive speed limits that change according to the tunnel's operational status. These signs are usually installed every 400 meters and respond to real-time conditions such as traffic density, weather, incidents, or maintenance. The system automatically adjusts speed limits to optimize safety and traffic flow, reducing the risk of accidents during adverse conditions."
            },
            vms: {
                title: "Variable Message Signs (VMS)",
                content: "Variable Message Signs are located at tunnel accesses and inside the tunnel to provide real-time information about tunnel status and alternative routes. Large VMS units at the entrance display comprehensive information about tunnel conditions and diversion routes, while smaller VMS units inside the tunnel provide updates and warnings to drivers already in the tunnel. This system is essential for effective traffic management and incident response."
            },
            overheight: {
                title: "Over-Height Vehicle Detection System",
                content: "This system prevents vehicles exceeding the tunnel height limit from entering. It consists of two poles with photoelectric barriers that detect over-height vehicles. A magnetic loop or additional barrier confirms the detection was caused by a vehicle. The system includes variable message signs to warn drivers, emergency telephones for communication with the control center, and CCTV cameras for operator verification. This prevents structural damage and dangerous situations."
            },
            dangerous: {
                title: "Dangerous Goods Vehicle Detection",
                content: "Advanced CCTV cameras with video image processing detect dangerous goods plates on vehicles. This system can either prevent access or monitor the passage of hazardous materials through the tunnel. It includes variable message signs for driver instructions and cameras at both entry and exit points to track the vehicle's complete journey. This ensures compliance with safety regulations and enables appropriate emergency response protocols."
            },
            hotspot: {
                title: "Hot Spot Detection System",
                content: "This advanced system combines thermal infrared cameras with laser scanners to detect overheated vehicle components before tunnel entry. It creates a 3D model of each vehicle and superimposes temperature profiles to identify hotspots on wheels, cabins, or exhaust systems. The high frame rate enables free-flow detection at motorway speeds. By identifying high-risk vehicles, the system prevents potential fires and their tragic consequences, including casualties and extended tunnel closures."
            },
            emergency: {
                title: "Emergency Telephone System",
                content: "Emergency telephones are strategically placed every 150 to 200 meters throughout the tunnel, depending on local regulations. These hands-free devices feature push buttons with integrated microphones and loudspeakers, enabling direct communication between tunnel users and the control center. They are essential for reporting incidents, requesting assistance, and receiving instructions during emergencies."
            },
            pa: {
                title: "Public Address System",
                content: "The Public Address System consists of loudspeaker groups installed along the tunnel connected to the control center. Multiple voice message zones are defined in each tube, allowing operators to transmit targeted messages to specific tunnel sections. This zoned approach enables precise communication during emergencies, guiding users to safety or providing specific instructions to affected areas without causing unnecessary alarm throughout the entire tunnel."
            },
            lpr: {
                title: "License Plate Recognition System",
                content: "Advanced video image processing enables sophisticated applications including travel time measurement based on average speed between detection points, real-time calculation of vehicles inside the tunnel, speed-over-distance enforcement, and management of black and white lists. This technology has evolved from science fiction to practical, reliable implementation, providing comprehensive traffic monitoring and enforcement capabilities."
            },
            fire: {
                title: "Fire Safety and Emergency Protocol",
                content: "The primary priorities during fire incidents are: facilitating self-evacuation of users, protecting those unable to leave, enabling fast and safe emergency service access, and protecting tunnel infrastructure. Key measures include scheduled fire drills, rapid detection and alert systems, detailed fire information systems, dedicated emergency vehicle access, fire extinction supervision via CCTV, coordination with emergency services through radio links, strategically placed fire hoses, controlled air flow direction, communication systems (loudspeakers, radio, VMS), signalized safe rooms with fire extinguishers and emergency equipment, infrared cameras for user location, fire-proof components, fan activation, water mist systems, and access control for high-risk vehicles."