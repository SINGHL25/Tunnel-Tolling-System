<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Tunnel Control & Tolling System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(102, 126, 234, 0.5); }
            to { text-shadow: 0 0 20px rgba(102, 126, 234, 0.8); }
        }

        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .panel h2 {
            margin-bottom: 20px;
            font-size: 1.6em;
            border-bottom: 3px solid rgba(102, 126, 234, 0.5);
            padding-bottom: 12px;
        }

        .tunnel-container {
            position: relative;
            background: linear-gradient(180deg, #1a1a1a 0%, #0a0a0a 50%, #1a1a1a 100%);
            border-radius: 20px;
            padding: 40px;
            min-height: 500px;
            overflow: hidden;
        }

        .tunnel-road {
            position: relative;
            height: 350px;
            background: linear-gradient(to bottom, #2a2a2a 0%, #1a1a1a 50%, #2a2a2a 100%);
            border-radius: 15px;
            overflow: hidden;
            margin-top: 30px;
        }

        .lane-divider {
            position: absolute;
            width: 100%;
            height: 3px;
            background: repeating-linear-gradient(to right, #ffeb3b 0px, #ffeb3b 40px, transparent 40px, transparent 80px);
            animation: road-scroll 2s linear infinite;
        }

        @keyframes road-scroll {
            0% { background-position: 0 0; }
            100% { background-position: 80px 0; }
        }

        .vehicle {
            position: absolute;
            width: 70px;
            height: 40px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border-radius: 8px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            z-index: 10;
            transition: all 0.1s linear;
        }

        .vehicle::before {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffeb3b;
            border-radius: 50%;
            top: 5px;
            left: 8px;
            box-shadow: 45px 0 0 #ffeb3b, 0 23px 0 #ff0000, 45px 23px 0 #ff0000;
        }

        .vehicle.hot {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            animation: hot-pulse 0.8s infinite;
        }

        .vehicle.dangerous {
            background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);
            animation: warning-flash 0.5s infinite;
        }

        .vehicle.overheight {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            height: 65px;
        }

        @keyframes hot-pulse {
            0%, 100% { box-shadow: 0 0 20px #ff0000; }
            50% { box-shadow: 0 0 40px #ff0000; }
        }

        @keyframes warning-flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .traffic-light {
            display: inline-block;
            width: 35px;
            height: 95px;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 8px;
            padding: 6px;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .light {
            width: 23px;
            height: 23px;
            border-radius: 50%;
            margin: 4px auto;
            opacity: 0.2;
            transition: all 0.3s;
        }

        .light.red { background: #ff0000; }
        .light.yellow { background: #ffeb3b; }
        .light.green { background: #4caf50; }

        .light.active {
            opacity: 1;
            box-shadow: 0 0 25px currentColor;
        }

        .sign {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 4px solid #ffeb3b;
            border-radius: 12px;
            padding: 18px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.3em;
        }

        .sign.warning {
            border-color: #ff9800;
            color: #ff9800;
        }

        .sign.danger {
            border-color: #ff0000;
            color: #ff0000;
            animation: sign-blink 0.5s infinite;
        }

        @keyframes sign-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
            margin: 5px 0;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        button.emergency {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
        }

        button.success {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(102, 126, 234, 0.2);
            padding: 18px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #667eea;
        }

        .sensor-indicator {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin: 10px 0;
            cursor: pointer;
        }

        .sensor-indicator:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .indicator-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 12px;
        }

        .indicator-dot.active {
            background: #4caf50;
            box-shadow: 0 0 10px #4caf50;
            animation: pulse-dot 2s infinite;
        }

        .indicator-dot.warning {
            background: #ff9800;
            box-shadow: 0 0 10px #ff9800;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .transaction-log {
            max-height: 220px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 12px;
            font-size: 0.88em;
            font-family: 'Courier New', monospace;
        }

        .log-entry {
            padding: 6px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .status-item {
            text-align: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .status-value {
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 5px;
        }

        .kb-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .kb-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(5px);
        }

        .kb-item h3 {
            font-size: 1.05em;
            margin-bottom: 6px;
            color: #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 35px;
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-close {
            float: right;
            font-size: 2em;
            cursor: pointer;
            color: #fff;
        }

        @media (max-width: 1400px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöá Advanced Tunnel Control & Tolling System</h1>
            <p class="subtitle">Intelligent Traffic Management & Safety Monitoring</p>
        </header>

        <div class="status-bar">
            <div class="status-item">
                <div>System Status</div>
                <div class="status-value" id="systemStatus">OPERATIONAL</div>
            </div>
            <div class="status-item">
                <div>Traffic Flow</div>
                <div class="status-value" id="trafficFlow">NORMAL</div>
            </div>
            <div class="status-item">
                <div>Alerts</div>
                <div class="status-value" id="alertCount">0</div>
            </div>
            <div class="status-item">
                <div>Uptime</div>
                <div class="status-value" id="uptime">00:00:00</div>
            </div>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2>üéõÔ∏è Control Center</h2>
                
                <h3 style="font-size: 1.1em; margin-bottom: 10px;">Add Vehicles</h3>
                <button onclick="app.addVehicle('normal')" class="success">üöó Normal Vehicle</button>
                <button onclick="app.addVehicle('hot')" class="emergency">üî• Hot Vehicle</button>
                <button onclick="app.addVehicle('dangerous')" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%)">‚ò¢Ô∏è Dangerous Goods</button>
                <button onclick="app.addVehicle('overheight')" style="background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%)">üìè Over-Height</button>

                <h3 style="font-size: 1.1em; margin: 20px 0 10px 0;">Traffic Lights</h3>
                <div style="display: flex; justify-content: space-around;">
                    <div>
                        <div class="traffic-light">
                            <div class="light red" id="entryRed"></div>
                            <div class="light yellow" id="entryYellow"></div>
                            <div class="light green active" id="entryGreen"></div>
                        </div>
                        <div style="text-align: center; font-size: 0.85em;">Entry</div>
                    </div>
                    <div>
                        <div class="traffic-light">
                            <div class="light red" id="exitRed"></div>
                            <div class="light yellow" id="exitYellow"></div>
                            <div class="light green active" id="exitGreen"></div>
                        </div>
                        <div style="text-align: center; font-size: 0.85em;">Exit</div>
                    </div>
                </div>

                <div class="sign" id="mainSign">TUNNEL OPEN - DRIVE SAFELY</div>

                <h3 style="font-size: 1.1em; margin: 20px 0 10px 0;">System Tests</h3>
                <button onclick="app.testTrafficLights()">Test Traffic Lights</button>
                <button onclick="app.testVMS()">Test Variable Signs</button>
                <button onclick="app.testSensors()">Test All Sensors</button>
                <button onclick="app.testCameras()">Test Cameras</button>

                <h3 style="font-size: 1.1em; margin: 20px 0 10px 0; color: #ff0000;">Emergency</h3>
                <button onclick="app.emergencyClose()" class="emergency">‚õî EMERGENCY CLOSURE</button>
                <button onclick="app.fireAlarm()" class="emergency">üî• FIRE ALARM</button>
                <button onclick="app.resetSystem()" class="success">‚úì Reset System</button>
            </div>

            <div class="panel">
                <h2>üõ£Ô∏è Tunnel Visualization</h2>
                <div class="tunnel-container">
                    <div class="tunnel-road" id="tunnelRoad">
                        <div style="position: absolute; top: 33.33%; left: 0; right: 0;">
                            <div class="lane-divider"></div>
                        </div>
                        <div style="position: absolute; top: 66.66%; left: 0; right: 0;">
                            <div class="lane-divider"></div>
                        </div>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="vehicleCount">0</div>
                        <div class="stat-label">Vehicles in Tunnel</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalTransactions">0</div>
                        <div class="stat-label">Transactions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgSpeed">80</div>
                        <div class="stat-label">Avg Speed (km/h)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="revenue">$0</div>
                        <div class="stat-label">Revenue</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>üìä Monitoring</h2>
                
                <h3 style="font-size: 1.05em; margin-bottom: 12px;">Detection Systems</h3>
                <div class="sensor-indicator" onclick="app.testSensor('overheight')">
                    <div class="indicator-dot active" id="sensor-overheight"></div>
                    <span>Over-Height Detection</span>
                </div>
                <div class="sensor-indicator" onclick="app.testSensor('hotspot')">
                    <div class="indicator-dot active" id="sensor-hotspot"></div>
                    <span>Hot Spot Detection</span>
                </div>
                <div class="sensor-indicator" onclick="app.testSensor('dangerous')">
                    <div class="indicator-dot active" id="sensor-dangerous"></div>
                    <span>Dangerous Goods</span>
                </div>
                <div class="sensor-indicator" onclick="app.testSensor('lpr')">
                    <div class="indicator-dot active" id="sensor-lpr"></div>
                    <span>License Plate Recognition</span>
                </div>

                <h3 style="font-size: 1.05em; margin: 20px 0 12px 0;">Transaction Log</h3>
                <div class="transaction-log" id="transactionLog"></div>

                <h3 style="font-size: 1.05em; margin: 20px 0 12px 0;">Knowledge Base</h3>
                <div style="max-height: 300px; overflow-y: auto;">
                    <div class="kb-item" onclick="app.showKB('lcs')">
                        <h3>Lane Control Signs</h3>
                        <p style="font-size: 0.88em; opacity: 0.85;">Display lane status every 200-400m</p>
                    </div>
                    <div class="kb-item" onclick="app.showKB('vsls')">
                        <h3>Speed Limit Signs</h3>
                        <p style="font-size: 0.88em; opacity: 0.85;">Variable speed limits every 400m</p>
                    </div>
                    <div class="kb-item" onclick="app.showKB('vms')">
                        <h3>Variable Message Signs</h3>
                        <p style="font-size: 0.88em; opacity: 0.85;">Tunnel status and diversion routes</p>
                    </div>
                    <div class="kb-item" onclick="app.showKB('fire')">
                        <h3>Fire Safety Protocol</h3>
                        <p style="font-size: 0.88em; opacity: 0.85;">Emergency procedures and evacuation</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="kbModal">
        <div class="modal-content">
            <span class="modal-close" onclick="app.closeModal()">&times;</span>
            <h2 id="modalTitle">System Information</h2>
            <p id="modalContent" style="line-height: 1.7; margin-top: 15px;"></p>
        </div>
    </div>

    <script>
        const app = {
            state: {
                vehicles: [],
                nextId: 1,
                transactions: 0,
                revenue: 0,
                startTime: Date.now(),
                emergencyMode: false,
                alerts: 0
            },

            kb: {
                lcs: {
                    title: "Lane Control Signs (LCS)",
                    content: "Lane Control Signs display the current status of traffic lanes and signalize traffic diversions. Usually installed every 200-400m throughout the tunnel to ensure continuous visibility."
                },
                vsls: {
                    title: "Vehicle Speed Limit Signs (VSLS)",
                    content: "Display current speed limits according to tunnel status. Usually installed every 400m. Speed limits adapt dynamically based on traffic conditions, incidents, and weather."
                },
                vms: {
                    title: "Variable Message Signs (VMS)",
                    content: "Located at tunnel accesses to indicate tunnel status and display diversion routes. Small VMS are also installed inside the tunnel for real-time information."
                },
                fire: {
                    title: "Fire Safety Protocol",
                    content: "Priorities: Facilitate self-evacuation, protect users who cannot leave, allow fast emergency service access, protect tunnel structure. Includes fire detection, ventilation control, PA system, emergency lighting, and cross-passages."
                }
            },

            init() {
                this.log('System initialized successfully');
                this.log('All subsystems operational');
                setInterval(() => this.moveVehicles(), 50);
                setInterval(() => this.updateUptime(), 1000);
                setInterval(() => this.autoGenerateTraffic(), 5000);
            },

            addVehicle(type) {
                const vehicle = {
                    id: this.state.nextId++,
                    type: type,
                    position: 0,
                    lane: Math.floor(Math.random() * 3),
                    speed: 3 + Math.random() * 2,
                    element: null
                };

                const el = document.createElement('div');
                el.className = `vehicle ${type}`;
                el.style.left = '20px';
                el.style.top = (vehicle.lane * 116 + 35) + 'px';
                el.onclick = () => this.showVehicleInfo(vehicle);

                document.getElementById('tunnelRoad').appendChild(el);
                vehicle.element = el;
                this.state.vehicles.push(vehicle);

                this.updateCount();
                this.log(`Vehicle V${vehicle.id} (${type}) entered`);

                if (type === 'hot') {
                    this.alert('HOT SPOT DETECTED');
                    this.flashSensor('hotspot');
                } else if (type === 'dangerous') {
                    this.alert('DANGEROUS GOODS DETECTED');
                    this.flashSensor('dangerous');
                } else if (type === 'overheight') {
                    this.alert('OVER-HEIGHT VEHICLE');
                    this.flashSensor('overheight');
                }
                this.flashSensor('lpr');
            },

            moveVehicles() {
                if (this.state.emergencyMode) return;

                this.state.vehicles = this.state.vehicles.filter(v => {
                    v.position += v.speed;
                    if (v.element) {
                        v.element.style.left = (20 + v.position) + 'px';
                    }

                    if (v.position > 850) {
                        if (v.element) v.element.remove();
                        this.processToll(v);
                        return false;
                    }
                    return true;
                });

                this.updateCount();
            },

            processToll(vehicle) {
                const rates = { normal: 5, hot: 10, dangerous: 15, overheight: 20 };
                const amount = rates[vehicle.type] || 5;
                
                this.state.transactions++;
                this.state.revenue += amount;
                
                document.getElementById('totalTransactions').textContent = this.state.transactions;
                document.getElementById('revenue').textContent = '$' + this.state.revenue;
                
                this.log(`Toll: V${vehicle.id} $${amount}`);
            },

            updateCount() {
                document.getElementById('vehicleCount').textContent = this.state.vehicles.length;
            },

            showVehicleInfo(v) {
                alert(`Vehicle V${v.id}\nType: ${v.type}\nLane: ${v.lane + 1}\nSpeed: ${Math.round(v.speed * 30)} km/h`);
            },

            testTrafficLights() {
                this.log('Testing traffic lights...');
                
                ['entry', 'exit'].forEach((loc, i) => {
                    setTimeout(() => {
                        document.getElementById(loc + 'Green').classList.remove('active');
                        document.getElementById(loc + 'Yellow').classList.add('active');
                        
                        setTimeout(() => {
                            document.getElementById(loc + 'Yellow').classList.remove('active');
                            document.getElementById(loc + 'Red').classList.add('active');
                            
                            setTimeout(() => {
                                document.getElementById(loc + 'Red').classList.remove('active');
                                document.getElementById(loc + 'Green').classList.add('active');
                            }, 2000);
                        }, 2000);
                    }, i * 1000);
                });
                
                setTimeout(() => this.log('Traffic lights test complete'), 5000);
            },

            testVMS() {
                const messages = ['SPEED LIMIT 60', 'KEEP DISTANCE', 'LANE CLOSED', 'TUNNEL OPEN'];
                let i = 0;
                
                this.log('Testing VMS...');
                
                const interval = setInterval(() => {
                    document.getElementById('mainSign').textContent = messages[i];
                    i++;
                    if (i >= messages.length) {
                        clearInterval(interval);
                        setTimeout(() => {
                            document.getElementById('mainSign').textContent = 'TUNNEL OPEN - DRIVE SAFELY';
                            this.log('VMS test complete');
                        }, 2000);
                    }
                }, 2000);
            },

            testSensor(type) {
                const el = document.getElementById('sensor-' + type);
                el.classList.remove('active');
                el.classList.add('warning');
                
                this.log(`Testing ${type} sensor...`);
                
                setTimeout(() => {
                    el.classList.remove('warning');
                    el.classList.add('active');
                    this.log(`${type} sensor OK`);
                }, 2000);
            },

            testSensors() {
                this.log('Testing all sensors...');
                ['overheight', 'hotspot', 'dangerous', 'lpr'].forEach((s, i) => {
                    setTimeout(() => this.testSensor(s), i * 500);
                });
                setTimeout(() => this.log('All sensors operational'), 2500);
            },

            testCameras() {
                this.log('Testing camera system...');
                setTimeout(() => {
                    this.log('CAM-01 OK');
                    setTimeout(() => {
                        this.log('CAM-02 OK');
                        setTimeout(() => {
                            this.log('All cameras operational');
                        }, 500);
                    }, 500);
                }, 500);
            },

            flashSensor(type) {
                const el = document.getElementById('sensor-' + type);
                if (el) {
                    el.classList.add('warning');
                    setTimeout(() => {
                        el.classList.remove('warning');
                        el.classList.add('active');
                    }, 1000);
                }
            },

            emergencyClose() {
                this.state.emergencyMode = true;
                this.log('‚ö†Ô∏è EMERGENCY CLOSURE ACTIVATED');
                
                document.getElementById('entryGreen').classList.remove('active');
                document.getElementById('entryRed').classList.add('active');
                document.getElementById('exitGreen').classList.remove('active');
                document.getElementById('exitRed').classList.add('active');
                
                document.getElementById('mainSign').textContent = '‚õî TUNNEL CLOSED';
                document.getElementById('mainSign').className = 'sign danger';
                
                document.getElementById('systemStatus').textContent = 'EMERGENCY';
                document.getElementById('trafficFlow').textContent = 'CLOSED';
                
                this.alert('EMERGENCY CLOSURE');
            },

            fireAlarm() {
                this.emergencyClose();
                this.log('üî• FIRE ALARM ACTIVATED');
                alert('FIRE ALARM!\n\nEmergency Protocols:\n‚úì Tunnel closed\n‚úì Emergency services notified\n‚úì Ventilation activated\n‚úì PA system active\n‚úì Emergency exits illuminated');
            },

            resetSystem() {
                this.state.emergencyMode = false;
                
                document.getElementById('entryRed').classList.remove('active');
                document.getElementById('entryGreen').classList.add('active');
                document.getElementById('exitRed').classList.remove('active');
                document.getElementById('exitGreen').classList.add('active');
                
                document.getElementById('mainSign').textContent = 'TUNNEL OPEN - DRIVE SAFELY';
                document.getElementById('mainSign').className = 'sign';
                
                document.getElementById('systemStatus').textContent = 'OPERATIONAL';
                document.getElementById('trafficFlow').textContent = 'NORMAL';
                this.state.alerts = 0;
                document.getElementById('alertCount').textContent = '0';
                
                this.log('‚úì System reset complete');
            },

            alert(msg) {
                this.state.alerts++;
                document.getElementById('alertCount').textContent = this.state.alerts;
                
                const sign = document.getElementById('mainSign');
                sign.textContent = msg;
                sign.className = 'sign warning';
                
                if (!this.state.emergencyMode) {
                    setTimeout(() => {
                        sign.textContent = 'TUNNEL OPEN - DRIVE SAFELY';
                        sign.className = 'sign';
                    }, 4000);
                }
            },

            log(msg) {
                const log = document.getElementById('transactionLog');
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                const time = new Date().toLocaleTimeString();
                entry.textContent = `[${time}] ${msg}`;
                log.insertBefore(entry, log.firstChild);
                
                while (log.children.length > 50) {
                    log.removeChild(log.lastChild);
                }
            },

            updateUptime() {
                const elapsed = Date.now() - this.state.startTime;
                const h = Math.floor(elapsed / 3600000);
                const m = Math.floor((elapsed % 3600000) / 60000);
                const s = Math.floor((elapsed % 60000) / 1000);
                
                document.getElementById('uptime').textContent = 
                    `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            },

            autoGenerateTraffic() {
                if (!this.state.emergencyMode && Math.random() > 0.5) {
                    const types = ['normal', 'normal', 'normal', 'normal', 'hot', 'dangerous', 'overheight'];
                    const type = types[Math.floor(Math.random() * types.length)];
                    this.addVehicle(type);
                }
            },

            showKB(topic) {
                const kb = this.kb[topic];
                if (kb) {
                    document.getElementById('modalTitle').textContent = kb.title;
                    document.getElementById('modalContent').textContent = kb.content;
                    document.getElementById('kbModal').classList.add('active');
                    this.log(`Knowledge base: ${kb.title}`);
                }
            },

            closeModal() {
                document.getElementById('kbModal').classList.remove('active');
            }
        };

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            app.init();
            
            // Close modal on outside click
            window.onclick = (e) => {
                if (e.target.id === 'kbModal') {
                    app.closeModal();
                }
            };
            
            // Welcome message
            setTimeout(() => {
                alert('üöá TUNNEL CONTROL SYSTEM READY\n\n‚úì All systems operational\n‚úì Click buttons to test features\n‚úì Add vehicles to simulate traffic\n‚úì Test emergency protocols\n\nSystem ready!');
            }, 1000);
        });
    </script>
</body>
</html>